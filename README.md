
# Общее описание решения

Веб-сервис "Домсмотр" - это сервис, который прогнозирует работы по 
содержанию и ремонту объектов, на основе анализа событий с применением технологий машинного обучения.

Сервис использует открытую программную библотеку CatBoost, в совокупности с Python 
библиотекой Pandas. Пользователь имеет возможность провести базовый и продвинутый анализ.
Базовая версия, предполагает анализ всех событий, представленных в документе. Продвинутый анализ
предлагает выборочный анализ определенных объектов. После завершения анализа, пользователь
имеет возможность корректировать итоговый результат, если считает его недостаточно полным. В таком случае, модель анализа
проходит дополнительное обучение, улучшая свои результаты. В случае, если пользователь посчитал резуьтат верным,
он может экспортировать полученные данные. 

# Бизнес-логика проекта

В ходе разработки сервиса прогнозирования работ 
по содержанию и ремонту объектов 
городского хозяйства были выявлены следующие основные ограничения: <br>
   1. Сервис должен обрабатывать информацию получаемую из 
   документов в формате Excel с определенной структурой.
   2. Сервсис должен анализироватть полученную информацию с помощью 
   алгоритмов машинного обучения.
   3. На основе проанализированной информации сервис должен 
   формировать предложения по планированию работ по ремонту и 
   содержанию объектов Комплекса городского хозяйства города Москвы.
   4. Сервис должен предлагать пользователю возможность 
   корректировать предлагаемое решение.

Пользователями проекта являются:
  - Аналитики - загружают входные данные в сервис, 
    получают выходные данные и на их основе принимают решения.
  - Администраторы - контроллируют работу аналитиков, 
    проверяя правильность принятого решения.

На рисунке ниже изображена архитектура проекта. За основу была взята микросервесная архитектура,
поскольку она позволяет производить масштабирование проекта и обеспечивает автономную работу модулей.






![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112352575392579665/2023.drawio_2.png)




Рис. 1 Архитектура проекта








## Описание технической реализации</br>
### Работа модели анализа</br>
**CatBoost (Categorical Boosting)** - это алгоритм машинного обучения, 
который использует градиентный бустинг для работы с категориальными данными. 
Градиентный бустинг - это техника ансамблирования алгоритмов, которая 
применяет метод пошагового обучения слабых моделей, создавая сильную модель 
путем устранения ошибок предыдущих моделей. В случае CatBoost, основными 
используемыми моделями являются решающие деревья.

Принцип работы CatBoost состоит из следующих шагов:

1. **Подготовка данных:** CatBoost применяет технику "целевого кодирования" 
(target encoding) для преобразования категориальных данных в числовые 
значения, что упрощает обучение и предсказание. Целевое кодирование 
выполняется в специальном порядке и путем сглаживания, что позволяет 
бороться с переобучением.

2. **Обучение решающих деревьев:** На каждой итерации строится новое 
решающее дерево, которое предсказывает некоторое число - отклонение от 
предыдущей композиции моделей. Перед построением дерева вычисляется градиент 
функции потерь на каждом объекте обучающей выборки, итеративно обновляя этот
градиент с учетом предыдущих деревьев.

3. **Сокращение скорости обучения:** CatBoost использует параметр скорости 
обучения (learning rate) для определения веса каждого дерева. Это позволяет 
контролировать обучение и уменьшать переобучение модели.

4. **Регуляризация:** CatBoost также содержит различные регуляризаторы, 
которые помогают сдерживать сложность модели и уменьшать переобучение.

5. **Останов обучения:** CatBoost может прекращать обучение ранее, если 
ошибка на валидационной выборке начинает увеличиваться, что предотвращает 
ненужное обучение и переобучение модели на обучающей выборке.

6. **Оценка и применение модели:** После оптимального обучения ансамбля 
деревьев, CatBoost можно использовать для прогнозирования на новых данных, 
применяя решающие деревья по очереди и суммируя их результаты с учетом весов,
определенных на этапе обучения.

**CatBoost** - это простой в использовании, но мощный алгоритм машинного 
обучения, который хорошо подходит для обработки категориальных данных и 
достижения высокой производительности.
### Алгоритм обучения модели анализа
1. **Подготовка данных:** Обработка категориальных признаков с применением 
отображения признаков, разделение на обучающие и тестовые наборы.
2. **Инициализация:** Создание начальной простой модели, обычно используется 
константное значение.
3. **Итерации:** Циклическое обучение базовых моделей следующим образом:
   1. ***Вычисление градиентов:*** Расчет градиента и гессиана ошибки для каждого 
   объекта обучающей выборки.
   2. ***Построение дерева:*** Выбор лучших разбиений на основе значений градиента
   и гессиана для создания нового дерева в ансамбле.
   3. ***Обновление модели:*** Объединение нового дерева с предыдущими деревьями 
   с использованием оптимального шага обучения.
   4. ***Остановка:*** Процесс итераций заканчивается по достижении заданного 
   количества итераций или при удовлетворении критерия остановки какой-то метрики, такой как ошибка на валидационной выборке.
4. **Тестирование:** Оценка качества модели на тестовом наборе данных и 
интерпретация результатов.
### Выборка для обучения
Датасеты предоставлемые заказчиком.

### Логика Backend`а и Модель данных
[Агент авторизации](http://178.170.192.87:8001/docs/)<br>
[Агент хранения необработанных данных](http://178.170.192.87:8002/docs/)<br>
[Модель анализа](http://178.170.192.87:8003/docs)<br>
[Агент нормализации](http://178.170.192.87:8004/docs)<br>

## Стек технологий
### Frontend:<br>
**React** - позволяет создавать 
высокопроизводительные, масштабируемые и легко поддерживаемые
веб-приложений<br>
**Mobx** - легко интегрируется с React, быстр и эффективен,
эффективно управляет состоянием компонентов <br>
**Mantine** - имеет обширный список интерактивных компоненов, совместим с TypeScript <br>
**TypeScript** - лёгкок в развитии и тестировании.

### Backend:<br>
**Node.js** - очень легковесный, позволяет использовать JavaScript как на стороне клиента, так и на стороне сервера. Это сокращает время разработки и упрощает совместную работу разработчиков фронтенда и бэкенда.<br>
**Express.js** - предоставляет простой и интуитивно понятный API, который позволяет быстро создавать приложения.<br>
**MongoDB** - хранит данные в формате документов, что позволяет гибко изменять структуру данных без необходимости вносить изменения в схему базы данных. Это дает возможность легко обрабатывать данные разной структуры, включая неструктурированные данные, что упрощает их анализ и использование.

### ML:<br>
**Python** -  позволяют быстро разрабатывать и тестировать модели машинного обучения.  <br>
**Pullenti** - имеет высокую точность при обработке текстов, обрабатывает тексты очень быстро, что позволяет использовать его для обработки большого объема данных. <br>
**CatBoost** - автоматически обрабатывает категориальные признаки, не требуя от пользователя их кодирования, включает в себя механизмы регуляризации, такие как L1, L2 и другие, что позволяет бороться с переобучением моделей.         <br> 
## Макеты


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112425556231860244/10.png?width=1202&height=676)


Рис. 2 Стек технологий



![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414826115911690/85f640ab39735a1a.png?width=1202&height=676)


Рис. 3 Экран входа


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414825641938964/da11af49cc7e969f.png?width=1202&height=676)


Рис. 4 Экран регистрации


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414779177435216/Analyzer.png?width=1115&height=676)


Рис. 5 Экран выбора анализа данных


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414779445891173/Analyzer-1.png?width=1006&height=676)


Рис. 6 Экран выбора анализа данных. Продвинутыый анализ


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414779781415053/History.png?width=784&height=676)


Рис. 7 Экран истории анализов


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414780024705154/History-1.png?width=1335&height=675)


Рис. 8 Экран истории анализов. При остуствии проведенных анализов


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414780255379497/Result_API.png?width=741&height=676)


Рис. 9 Экран редактирования полученных результатов


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414780586721280/Result_File.png?width=708&height=676)


Рис. 10 Экран редактирования полученных результатов при загруженном файле


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414780813234307/Result_Modal.png?width=1337&height=675)


Рис. 11 Экран редактирования категорий


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414781111017502/Result_Modal_Object.png?width=1337&height=675)


Рис. 12 Экран информации об объекте


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414781375250512/Result_Normal.png?width=703&height=676)


Рис. 13 Экран редактирования полученных результатов при продвинутом анализе


![display:block;margin:auto|](https://media.discordapp.net/attachments/993888805708906496/1112414778816745552/Result_Normal-1.png?width=1177&height=676)

Рис. 14 Экран подсказок по работе с сервисом



## Инструкция по установке и развертыванию:
Развернуть все Docker контейнеры.
## Инструкция пользователя:

### Вход
1. В окне регистрации выбрать роль сотрудника - "Аналитик" или "Старший аналитик".
2. Ввести пароль и логин(почту).
3. Нажать кнопку входа.
4. В случае отсутствии аккаунта, нажать на кнопку "Зарегистироваться"
### Регистрация
1.  В окне регистрации ввести фамилию, имя, логин(почту), пароль.
2.  Нажать кнопку "Вход".

### Анализ данных
1. Зайти в меню анализа данных
2. Выбрать вид анализа.
   1. Базовый - добавить Excel файл на компьютере или использовать документы из других департаментов.
   2. Продвинутый - помимо загрзуки Excel файла, выбрать категории, по которым будет проводится анализ.
3. Выбрать источник анализа.
4. Нажать кнопку "Начать".
5. После завершения анализа появляется модальное окно с результатами, пользователь может может изменить поля результатов, отфильтровать их, и сохранить.
6. Затем пользователь может посмотреть объекты благоустройства на карте.
7. Экспортировать результаты в форматы .xsl, .xslx, .csv.

### Просмотр истории анализов
1. Перейти во вкладку "История анализов"
2. В случае отстуствия истории проведенных анализов, проанализировать документ.




